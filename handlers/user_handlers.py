"""
–ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ –∏ –¥–µ–π—Å—Ç–≤–∏–π.

–°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞: /start, /help, 
–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Ç.–¥.
"""

from aiogram import types, F
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext

from database import db
from keyboards.user_kb import (main_keyboard, categories_keyboard, 
                              tools_keyboard, tool_detail_keyboard)

# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î

async def cmd_start(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start. 
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
    """
    user = message.from_user
    db.add_user(user_id=user.id, username=user.username, full_name=user.full_name)
    
    welcome_text = (
        "üèóÔ∏è <b>RentBrigadir</b> ‚Äì –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä ‚Ññ1 –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤!\n\n"
        "üéØ <b>–û –∫–æ–º–ø–∞–Ω–∏–∏:</b>\n"
        "‚Ä¢ 15 –ª–µ—Ç —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä—ã–Ω–∫–µ\n"
        "‚Ä¢ –õ–∏–¥–µ—Ä –≤ —Å—Ñ–µ—Ä–µ –∞—Ä–µ–Ω–¥—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è\n"
        "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –æ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤\n"
        "‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏\n\n"
        "üõ†Ô∏è <b>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ —ç—Ç–æ–º –±–æ—Ç–µ:</b>\n"
        "‚Ä¢ üîß –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å —Ü–µ–Ω–∞–º–∏\n"
        "‚Ä¢ üìù –ë—ã—Å—Ç—Ä–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∞—Ä–µ–Ω–¥—É\n"
        "‚Ä¢ üìû –£–∑–Ω–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã\n"
        "‚Ä¢ ‚ÑπÔ∏è –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ üëá"
    )
    await message.answer(welcome_text, reply_markup=main_keyboard(), parse_mode="HTML")

async def cmd_help(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞."""
    await show_help(message)

async def cmd_contacts(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /contacts. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é."""
    await show_contacts(message)

async def cmd_delivery(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /delivery. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç–∞–≤–∫–µ."""
    await show_delivery_info(message)

async def cmd_catalog(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /catalog. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤."""
    await show_categories(message)

# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –¢–ï–ö–°–¢–û–í–´–• –°–û–û–ë–©–ï–ù–ò–ô (–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ)

async def show_categories(message: types.Message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤."""
    categories = db.get_all_categories()
    
    if not categories:
        await message.answer("üì≠ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        return
    
    await message.answer(
        "üèóÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:",
        reply_markup=categories_keyboard(categories)
    )

async def show_contacts(message: types.Message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–æ–º–ø–∞–Ω–∏–∏."""
    contacts_text = (
        "üèóÔ∏è <b>RentBrigadir - –ê—Ä–µ–Ω–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</b>\n\n"
        "üìû <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>\n"
        "‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +7 (499) 350-85-72\n"
        "‚Ä¢ WhatsApp: +7 (950) 558-56-81\n\n"
        "üìç <b>–ê–¥—Ä–µ—Å:</b>\n"
        "–≥. –ú–æ—Å–∫–≤–∞, 1-–π –í–æ–ª–æ–∫–æ–ª–∞–º—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, 2–ë\n"
        "(–º. –û–∫—Ç—è–±—Ä—å—Å–∫–æ–µ –ø–æ–ª–µ, –ú–¶–ö –ü–∞–Ω—Ñ–∏–ª–æ–≤—Å–∫–∞—è)\n\n"
        "üïí <b>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</b>\n"
        "‚Ä¢ –ü–Ω-–ü—Ç: 8:00 - 19:00\n"
        "‚Ä¢ –°–±-–í—Å: 9:00 - 18:00\n"
        "‚Ä¢ –ë–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞ –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö\n\n"
        "‚úâÔ∏è <b>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</b>\n"
        "‚Ä¢ prokat@rentbrigadir.ru\n\n"
        "üåê <b>–°–∞–π—Ç:</b>\n"
        "www.rentbrigadir.ru\n\n"
        "üöö <b>–£—Å–ª—É–≥–∏:</b>\n"
        "‚Ä¢ –ê—Ä–µ–Ω–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤\n"
        "‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è\n"
        "‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤"
    )
    await message.answer(contacts_text, parse_mode="HTML")

async def show_delivery_info(message: types.Message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å–ª–æ–≤–∏—è—Ö –¥–æ—Å—Ç–∞–≤–∫–∏."""
    delivery_text = """
üöö <b>–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</b>

<b>–í –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î:</b>
‚Ä¢ –õ–µ–≥–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–¥–æ 50 –∫–≥) ‚Äì 1 490 ‚ÇΩ –≤ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü
‚Ä¢ –†—É—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–¥–æ 150 –∫–≥) ‚Äì 1 890 ‚ÇΩ –≤ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü  
‚Ä¢ –†—É—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (151-350 –∫–≥) ‚Äì 3 290 ‚ÇΩ –≤ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü
‚Ä¢ –¢—è–∂–µ–ª—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (351-600 –∫–≥) ‚Äì 3 990 ‚ÇΩ –≤ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü
‚Ä¢ –¢—è–∂–µ–ª—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (—Å–≤—ã—à–µ 600 –∫–≥) ‚Äì 4 990 ‚ÇΩ –≤ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü

üéØ <b>–ê–∫—Ü–∏—è!</b> –ü—Ä–∏ –∑–∞–∫–∞–∑–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ 6 –∫–º –æ—Ç –ø—É–Ω–∫—Ç–∞ –ø—Ä–æ–∫–∞—Ç–∞ - —Å–∫–∏–¥–∫–∞ 30% –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É

<b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</b>
‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ –¥–µ–Ω—å –≤ –¥–µ–Ω—å: +30% –∫ —Ç–∞—Ä–∏—Ñ—É
‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ –≤—Ä–µ–º–µ–Ω–∏ (¬±90 –º–∏–Ω—É—Ç): +790 ‚ÇΩ

<b>–ó–∞ –ú–ö–ê–î:</b>
‚Ä¢ –ü—Ä–∏–≤–µ–∑—Ç–∏ –∏ —É–≤–µ–∑—Ç–∏: —Ç–∞—Ä–∏—Ñ –ø–æ –ú–æ—Å–∫–≤–µ + 89 ‚ÇΩ/–∫–º
‚Ä¢ –í –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É: —Ç–∞—Ä–∏—Ñ –ø–æ –ú–æ—Å–∫–≤–µ + 49 ‚ÇΩ/–∫–º

<b>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã:</b>
‚Ä¢ –í—ã—à–∫–∏-—Ç—É—Ä—ã, –ª–µ—Å–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ, –ª–µ—Å—Ç–Ω–∏—Ü—ã –æ—Ç 3–º:
  - –î–æ 700 –∫–≥: 2 990 ‚ÇΩ (–∑–∞ –ú–ö–ê–î + 79 ‚ÇΩ/–∫–º)
  - 701-1000 –∫–≥: 3 990 ‚ÇΩ (–∑–∞ –ú–ö–ê–î + 89 ‚ÇΩ/–∫–º)
‚Ä¢ –í—ã–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ: 590 ‚ÇΩ –∑–∞ 100 –∫–≥

<b>–£—Å–ª—É–≥–∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–∞:</b>
‚Ä¢ –ü–æ–¥—ä—ë–º —Å—Ç—Ä–µ–ª—ã –¥–æ 1000 –∫–≥: 12 500 ‚ÇΩ –ø–æ –ú–æ—Å–∫–≤–µ
‚Ä¢ –ó–∞ –ú–ö–ê–î: 110 ‚ÇΩ/–∫–º

<b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</b>
‚Ä¢ –ü–æ–≥—Ä—É–∑–∫–∞/–≤—ã–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã: 300 ‚ÇΩ
‚Ä¢ –ü—Ä–æ—Å—Ç–æ–π —Å–≤—ã—à–µ 15 –º–∏–Ω—É—Ç: 19 ‚ÇΩ/–º–∏–Ω—É—Ç–∞
‚Ä¢ –ü–æ–¥—ä—ë–º –¥–æ 15 –∫–≥: 199 ‚ÇΩ (–ª–∏—Ñ—Ç) –∏–ª–∏ 149 ‚ÇΩ/—ç—Ç–∞–∂
‚Ä¢ –ü–æ–¥—ä—ë–º –¥–æ 25 –∫–≥: 299 ‚ÇΩ (–ª–∏—Ñ—Ç) –∏–ª–∏ 199 ‚ÇΩ/—ç—Ç–∞–∂
‚Ä¢ –ü–æ–¥—ä—ë–º —Å–≤—ã—à–µ 25 –∫–≥ ‚Äì –ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏

üí° <i>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è "–¥–æ –ø–æ–¥—ä–µ–∑–¥–∞"</i>
    """
    await message.answer(delivery_text, parse_mode="HTML")

async def show_help(message: types.Message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã."""
    help_text = (
        "‚ùì <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</b>\n\n"
        
        "üõ†Ô∏è <b>–ö–∞–∫ –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?</b>\n"
        "1. –ù–∞–∂–º–∏—Ç–µ 'üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã'\n"
        "2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç\n"
        "3. –ù–∞–∂–º–∏—Ç–µ 'üìù –ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å'\n"
        "4. –£–∫–∞–∂–∏—Ç–µ —Å—Ä–æ–∫ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã\n\n"
        
        "üí≥ <b>–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:</b>\n"
        "‚Ä¢ –ù–∞–ª–∏—á–Ω—ã–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏\n"
        "‚Ä¢ –ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π –∏–ª–∏ –ø–æ QR-–∫–æ–¥—É\n"
        "‚Ä¢ –ë–µ–∑–Ω–∞–ª–∏—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è —é—Ä. –ª–∏—Ü\n\n"
        
        "üöö <b>–î–æ—Å—Ç–∞–≤–∫–∞:</b>\n"
        "‚Ä¢ –ü–æ –ú–æ—Å–∫–≤–µ - –æ—Ç 1490‚ÇΩ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Å–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è)\n"
        "‚Ä¢ –ó–∞ –ú–ö–ê–î - + 89 —Ä—É–± –∑–∞ 1 –∫–º –¥–æ –º–µ—Å—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏\n"
        "‚Ä¢ –°–∞–º–æ–≤—ã–≤–æ–∑: –º. –û–∫—Ç—è–±—Ä—å—Å–∫–æ–µ –ø–æ–ª–µ, 1-–π –í–æ–ª–æ–∫–æ–ª–∞–º—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, 2–ë\n\n"
        
        "‚è∞ <b>–°—Ä–æ–∫–∏ –∞—Ä–µ–Ω–¥—ã:</b>\n"
        "‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫ - 1 –¥–µ–Ω—å\n"
        "‚Ä¢ –°–∫–∏–¥–∫–∏ –æ—Ç 2 –¥–Ω–µ–π\n"
        "‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏—è\n\n"
        
        "üìû <b>–ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è?</b>\n"
        "–ó–≤–æ–Ω–∏—Ç–µ: +7 (499) 350-85-72\n"
        "WhatsApp: +7 (950) 558-56-81\n\n"
        
        "‚ö° <b>–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
        "/catalog - –ö–∞—Ç–∞–ª–æ–≥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤\n"
        "/delivery - –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏\n"
        "/contacts - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n"
        "/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
    )
    await message.answer(help_text, parse_mode="HTML")


# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò CALLBACK-–ó–ê–ü–†–û–°–û–í (–ò–ù–°–¢–†–£–ú–ï–ù–¢–´)

# –í —Ñ—É–Ω–∫—Ü–∏–∏ show_tools_by_category:
async def show_tools_by_category(callback: types.CallbackQuery):
    category_id = int(callback.data.split("_")[1])
    tools = db.get_tools_by_category(category_id)
    category = db.get_category_by_id(category_id)
    
    if not tools:
        await callback.message.edit_text("–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
        return
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ - —Ç–æ–ª—å–∫–æ id –∏ name
    category_name = category[1] if category else "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã"
    
    await callback.message.edit_text(
        f"<b>{category_name}</b>\n"
        "–¶–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –∑–∞ 1 –¥–µ–Ω—å –∞—Ä–µ–Ω–¥—ã",
        reply_markup=tools_keyboard(tools),
        parse_mode="HTML"
    )
    await callback.answer()

async def show_tool_detail(callback: types.CallbackQuery):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ."""
    tool_id = int(callback.data.split("_")[1])
    tool = db.get_tool_by_id(tool_id)
    
    if not tool:
        await callback.message.edit_text("‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return

    # –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    (tool_id, name, description, category_id, 
     price_1, price_2, price_3, price_4, price_5, price_6, price_7, price_14, price_30,
     deposit, image_url, available) = tool
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —Ü–µ–Ω–∞–º–∏
    price_list = "\n".join([
        f"‚Ä¢ 1 –¥–µ–Ω—å: {price_1}‚ÇΩ", f"‚Ä¢ 2 –¥–Ω—è: {price_2}‚ÇΩ", f"‚Ä¢ 3 –¥–Ω—è: {price_3}‚ÇΩ",
        f"‚Ä¢ 4 –¥–Ω—è: {price_4}‚ÇΩ", f"‚Ä¢ 5 –¥–Ω–µ–π: {price_5}‚ÇΩ", f"‚Ä¢ 6 –¥–Ω–µ–π: {price_6}‚ÇΩ",
        f"‚Ä¢ 7 –¥–Ω–µ–π: {price_7}‚ÇΩ", f"‚Ä¢ 14 –¥–Ω–µ–π: {price_14}‚ÇΩ", f"‚Ä¢ 30 –¥–Ω–µ–π: {price_30}‚ÇΩ"
    ])
    
    text = (
        f"üîß <b>{name}</b>\n\n"
        f"{description}\n\n"
        f"üíµ <b>–¶–µ–Ω—ã –∑–∞ –∞—Ä–µ–Ω–¥—É:</b>\n{price_list}\n\n"
        f"üí∞ <b>–ó–∞–ª–æ–≥:</b> {deposit}‚ÇΩ\n\n"
        f"üìû –î–ª—è –∞—Ä–µ–Ω–¥—ã –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
    )
    
    await callback.message.edit_text(text, reply_markup=tool_detail_keyboard(tool_id), parse_mode="HTML")

async def back_to_categories(callback: types.CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤."""
    categories = db.get_all_categories()
    
    if not categories:
        await callback.message.edit_text("üì≠ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
        return
    
    await callback.message.edit_text(
        "üèóÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:",
        reply_markup=categories_keyboard(categories)
    )
    await callback.answer()

async def back_to_main(callback: types.CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é."""
    await callback.message.edit_text("üèóÔ∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ RentBrigadir!")
    await callback.message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=main_keyboard()
    )
    await callback.answer()


async def back_to_tools(callback: types.CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ —Å–ø–∏—Å–∫—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    # –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–µ—Ä–Ω–µ–º –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    categories = db.get_all_categories()
    
    if not categories:
        await callback.message.edit_text("üì≠ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
        return
    
    await callback.message.edit_text(
        "üèóÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:",
        reply_markup=categories_keyboard(categories)
    )
    await callback.answer()


async def cancel_to_tools(callback: types.CallbackQuery, state: FSMContext):
    """–û—Ç–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤."""
    await state.clear()
    categories = db.get_all_categories()
    await callback.message.edit_text(
        "üèóÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:",
        reply_markup=categories_keyboard(categories)
    )
    await callback.answer()